openapi: 3.0.0
info:
  title: API HyperFresh Anti-Gaspi
  description: API complète incluant la gestion Utilisateurs, Commandes et Stocks.
  version: 1.0.0
servers:
  - url: http://localhost:3000/api/v1
    description: Serveur de Production

tags:
  - name: Auth
    description: Connexion et Inscription
  - name: Paniers
    description: Catalogue des invendus
  - name: Commandes
    description: Gestion des achats

paths:
  # --- AUTHENTIFICATION ---
  /auth/login:
    post:
      tags: [Auth]
      summary: Connexion utilisateur
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthInput'
      responses:
        '200':
          description: Connexion réussie
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'

  # --- PANIERS ---
  /paniers:
    get:
      tags: [Paniers]
      summary: Lister les paniers disponibles
      parameters:
        - in: query
          name: ville
          schema:
            type: string
        - in: query
          name: max_price
          schema:
            type: number
      responses:
        '200':
          description: Liste récupérée
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Panier'
    
    post:
      tags: [Paniers]
      summary: Ajouter un panier (Magasin)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PanierInput'
      responses:
        '201':
          description: Panier créé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Panier'

  /paniers/{id}:
    get:
      tags: [Paniers]
      summary: Détail d'un panier
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Panier trouvé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Panier'

  # --- COMMANDES ---
  /commandes:
    post:
      tags: [Commandes]
      summary: Créer une nouvelle commande
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommandeInput'
      responses:
        '201':
          description: Commande validée
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Commande'

  /commandes/historique:
    get:
      tags: [Commandes]
      summary: Mes commandes passées
      responses:
        '200':
          description: Historique utilisateur
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Commande'

  # --- UTILISATEUR & IMPACT ---
  /users/me:
    get:
      tags: [Auth]
      summary: Profil de l'utilisateur connecté (et stats RSE)
      responses:
        '200':
          description: Profil complet
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

components:
  schemas:
    # --- MODELE 1 : UTILISATEUR ---
    User:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
          format: email
        password:
          type: string
        role:
          type: string
          enum: [student, store_manager, admin]
        impact_co2:
          type: number
          description: Total CO2 économisé en kg
        impact_euros:
          type: number
          description: Total euros économisés

    # --- MODELE 2 : PANIER ---
    Panier:
      type: object
      properties:
        id:
          type: integer
        titre:
          type: string
        description:
          type: string
        prix:
          type: number
        valeur_reelle:
          type: number
        magasin_nom:
          type: string
        statut:
          type: string
          enum: [disponible, reserve, vendu]
        image_url:
          type: string

    # --- MODELE 3 : COMMANDE ---
    Commande:
      type: object
      properties:
        id:
          type: string
          format: uuid
        date_creation:
          type: string
          format: date-time
        status:
          type: string
          enum: [PENDING, PAID, COLLECTED]
        code_retrait:
          type: string
          description: Code à montrer au magasin
        panier:
          $ref: '#/components/schemas/Panier'
        user_id:
          type: integer

    # --- INPUTS ---
    AuthInput:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
        password:
          type: string
          format: password

    AuthResponse:
      type: object
      properties:
        token:
          type: string
        expiresIn:
          type: integer

    PanierInput:
      type: object
      required: [titre, prix, magasin_id]
      properties:
        titre:
          type: string
        prix:
          type: number
        magasin_id:
          type: integer
        description:
          type: string

    CommandeInput:
      type: object
      required: [panier_id]
      properties:
        panier_id:
          type: integer
        payment_token:
          type: string
