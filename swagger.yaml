openapi: 3.0.0
info:
  title: API HyperFresh (MySQL Version)
  description: API stricte avec gestion des produits, paniers composés et commandes.
  version: 2.0.0
servers:
  - url: http://localhost:3000/api/v1

tags:
  - name: Products
    description: Gestion du stock produits (Magasin)
  - name: Paniers
    description: Assemblage des paniers (Offres)
  - name: Orders
    description: Commandes étudiants

paths:
  # --- PRODUITS ---
  /products:
    get:
      tags: [Products]
      summary: Lister tous les produits en stock (pour composer des paniers)
      responses:
        '200':
          description: Liste des produits
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'
    post:
      tags: [Products]
      summary: Ajouter un produit au stock (Scan Code Barre)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductInput'
      responses:
        '201':
          description: Produit créé

  # --- PANIERS ---
  /paniers:
    get:
      tags: [Paniers]
      summary: Lister les paniers disponibles (Vue Étudiant)
      responses:
        '200':
          description: Liste des paniers avec leur contenu
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Panier'
    
    post:
      tags: [Paniers]
      summary: Créer un panier composé (Vue Magasin)
      description: On crée un panier en donnant une liste d'IDs de produits existants.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PanierInput'
      responses:
        '201':
          description: Panier mis en vente

  /paniers/{id}:
    get:
      tags: [Paniers]
      summary: Détail complet d'un panier (avec liste des produits)
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Panier et son contenu
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Panier'

  # --- COMMANDES ---
  /orders:
    post:
      tags: [Orders]
      summary: Passer commande
      description: L'étudiant réserve un panier via son ID.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderInput'
      responses:
        '201':
          description: Commande enregistrée
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'

components:
  schemas:
    # --- 1. PRODUIT (L'unité) ---
    Product:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        expiration_date:
          type: string
          format: date
        barcode:
          type: string
        original_price:
          type: number

    ProductInput: # Ce qu'on envoie pour créer un produit
      type: object
      required: [name, original_price]
      properties:
        name:
          type: string
        expiration_date:
          type: string
          format: date
        barcode:
          type: string
        original_price:
          type: number

    # --- 2. PANIER (Le lot) ---
    Panier:
      type: object
      properties:
        id:
          type: integer
        titre:
          type: string
        price:
          type: number
        store_name:
          type: string
        status:
          type: string
          enum: [disponible, reserve, vendu]
        # Ici on a la liste des VRAIS produits, pas juste des IDs
        items:
          type: array
          items:
            type: integer

    PanierInput: # Pour créer un panier, on envoie juste les IDs des produits
      type: object
      required: [titre, price, product_ids]
      properties:
        titre:
          type: string
        price:
          type: number
        store_name:
          type: string
        product_ids: # Tableau d'IDs (ex: [1, 4, 12])
          type: array
          items:
            type: integer

    # --- 3. COMMANDE (L'achat) ---
    Order:
      type: object
      properties:
        id:
          type: integer
        status:
          type: string
        pickup_code:
          type: string
        # En réponse, on peut renvoyer l'objet panier complet pour affichage
        panier_id:
          type: integer
        user_id:
          type: integer

    OrderInput: # Pour commander, on a besoin que de l'ID du panier
      type: object
      required: [panier_id]
      properties:
        panier_id:
          type: integer
